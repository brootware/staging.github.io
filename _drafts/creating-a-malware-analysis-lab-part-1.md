---
layout: post
title: Creating a malware analysis lab part 1
categories:
- Projects
- security-toolkit
tags:
- Projects
- security-toolkit
- vagrant
- forensics
- Automation
---
## Introduction

As I was doing a CTF based on [detecting log4j attacks with ransomware khonsari](https://brootware.github.io/posts/detecting-and-defending-against-log4j-attacks/) recently I came across a lot of the hurdles of setting up forensic tools like Autopsy, pdfid,  dotNet based debuggers and reverse engineering tools to solve the challenges. This took a lot of time! More than a day perhaps to troubleshoot look around for articles on how to setup on windows as I am currently using a mac. At first I tried to use Autopsy on mac but the features were severly lacking as the software is exposed via a web browser on localhost. There has to be a better way to solve this and gotta be ready the next time I do such blue team CTF. So basically the steps are

1. Setup a windows vm (either locally with virtualbox or in the cloud with Azure)
2. Read documentation on installing each tools needed for malware analysis
3. Install each tool
4. Troubleshoot during the installation.

## Enter flareVM by mandiant

[flareVM](https://github.com/mandiant/flare-vm) is a powershell install script created by mandiant. The tool itself is pretty great. But setting up a sandbox VM locally and installing the tool takes a lot of time! (4-5 hours, trust me I timed this). So the goal here is to make it easy to spin up a machine in an automated manner. To achieve this, I used vagrant and virtualbox.

## Imaging the FlareVM for disposability

This is the hardest part of making this project

## Uploading to vagrant cloud

## Conclusion

Some good sources I used to image the box

- <https://www.vagrantup.com/docs/boxes/base>
- <https://www.vagrantup.com/docs/providers/virtualbox/boxes>
- <https://coder-question.com/cq-blog/1534>
